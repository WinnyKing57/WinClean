#!/bin/sh
# postinst script for debian-storage-analyzer v3.0

set -e

case "$1" in
    configure)
        echo "ðŸš€ Installation de l'Analyseur de Stockage Debian v3.0..."
        
        # Installer automatiquement les dÃ©pendances manquantes
        echo "ðŸ“¦ VÃ©rification et installation des dÃ©pendances..."
        
        # Liste des paquets requis
        REQUIRED_PACKAGES="python3-gi python3-gi-cairo gir1.2-gtk-3.0 python3-psutil python3-matplotlib python3-pandas python3-reportlab"
        MISSING_PACKAGES=""
        
        # VÃ©rifier chaque paquet
        for pkg in $REQUIRED_PACKAGES; do
            if ! dpkg -l "$pkg" >/dev/null 2>&1; then
                MISSING_PACKAGES="$MISSING_PACKAGES $pkg"
            fi
        done
        
        # Installer les paquets manquants
        if [ -n "$MISSING_PACKAGES" ]; then
            echo "ðŸ“¥ Installation des dÃ©pendances manquantes:$MISSING_PACKAGES"
            apt-get update -qq
            apt-get install -y $MISSING_PACKAGES
        else
            echo "âœ… Toutes les dÃ©pendances sont dÃ©jÃ  installÃ©es"
        fi
        
        # Mettre Ã  jour la base de donnÃ©es des applications desktop
        if command -v update-desktop-database >/dev/null 2>&1; then
            update-desktop-database -q /usr/share/applications || true
        fi
        
        # Mettre Ã  jour le cache des icÃ´nes
        if command -v gtk-update-icon-cache >/dev/null 2>&1; then
            gtk-update-icon-cache -q -t -f /usr/share/icons/hicolor || true
        fi
        
        # Mettre Ã  jour la base de donnÃ©es MIME
        if command -v update-mime-database >/dev/null 2>&1; then
            update-mime-database /usr/share/mime || true
        fi
        
        # CrÃ©er le rÃ©pertoire de configuration par dÃ©faut
        mkdir -p /etc/skel/.config/debian-storage-analyzer
        
        # Informer l'utilisateur
        echo ""
        echo "ðŸŽ‰ Analyseur de Stockage Debian v3.0 installÃ© avec succÃ¨s!"
        echo ""
        echo "ðŸŽ¯ Vous pouvez maintenant:"
        echo "   â€¢ Le lancer depuis le menu Applications > SystÃ¨me"
        echo "   â€¢ Le chercher dans Discover/Software Center"
        echo "   â€¢ L'exÃ©cuter avec: debian-storage-analyzer"
        echo ""
        echo "âœ¨ Nouvelles fonctionnalitÃ©s v3.0:"
        echo "   â€¢ Interface moderne avec thÃ¨mes adaptatifs"
        echo "   â€¢ Clic droit sur fichiers pour ouvrir dans l'explorateur"
        echo "   â€¢ Graphiques interactifs et dÃ©tection de doublons"
        echo "   â€¢ Surveillance temps rÃ©el et historique"
        echo ""
        ;;
        
    abort-upgrade|abort-remove|abort-deconfigure)
        ;;
        
    *)
        echo "postinst called with unknown argument \`$1'" >&2
        exit 1
        ;;
esac

#DEBHELPER#

exit 0